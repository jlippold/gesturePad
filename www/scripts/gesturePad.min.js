/*!  gesturePad 2013-05-26 */
var DirecTV={changeChannel:function(e){var t=util.getCurrentDevice();$.getJSON("http://"+t.IPAddress+":"+t.Port+"/tv/tune?major="+e,function(){ui.clearNowPlaying(),setTimeout(function(){ui.queryNowPlaying()},3e3)})},startWorker:function(){try{clearTimeout(workerTimer)}catch(e){}for(var t=[],a=0,i=0;settings.userSettings.rooms.length>i;i++)for(var n=0;settings.userSettings.rooms[i].devices.length>n;n++)"DTV"==settings.userSettings.rooms[i].devices[n].shortname&&(t[a]="http://"+settings.userSettings.rooms[i].devices[n].IPAddress+":"+settings.userSettings.rooms[i].devices[n].Port+"/",$.ajaxq("DTVWorker"+a),a+=1);a=0;var o=!1;$.each(guide.channels,function(e){var i=guide.channels[e],n="0:00";if(i.startTime>0&&i.duration>0&&(n=util.hms2(i.startTime+i.duration-Math.floor((new Date).getTime()/1e3))),""===i.nowplaying||"0:00"==n){i.nowplaying="";for(var r=!1;r===!1;)a>t.length-1&&(a=0),t[a].room!=util.getCurrentDevice().shortname&&(DirecTV.refreshChannel(t[a],"DTVWorker"+a,e),o=!0,r=!0),a+=1}}),o===!1&&(workerTimer=setTimeout(function(){DirecTV.startWorker()},3e4))},setupWorker:function(e){if(DirecTV.hasDirecTV()!==!1){guide.channels=[];var t="";$(e).find("channels > channel").each(function(){if(t!=$(this).find("number").text()){var a={};a.number=$(this).find("number").text(),a.logo=$(this).find("logo").text(),a.callsign=$(this).find("callsign").text(),a.nowplaying="",a.ending=0,a.timeleft="",a.fullname=$(this).find("fullname").text(),a.startTime=0,a.duration=0;var i=$(e).find("channels > favorites > category > number").filter(function(){return $(this).text()==a.number});$(i).size()>0?(a.category=$(i).parent().attr("name"),a.catIndex=parseInt($(i).parent().attr("idx"),10)):(a.category="Unsorted",a.catIndex=999),guide.channels.push(a),t=a.number}}),guide.channels.sort(util.compare),DirecTV.startWorker()}},hasDirecTV:function(){for(var e=!1,t=0;settings.userSettings.rooms.length>t;t++)if(null!==settings.userSettings.rooms[t].DTV){e=!0;break}return e},loadChannelList:function(){var e="xml/channellist.xml?r="+Math.random();$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){DirecTV.setupWorker(e)},error:function(){util.doAlert("Error loading channel list: "+e)}})},refreshChannel:function(e,t,a){var i=guide.channels[a];$.ajaxq(t,{url:e+"tv/getProgInfo",dataType:"json",type:"GET",timeout:1e4,data:"major="+i.number,success:function(e){i.nowplaying=e.title,i.startTime=e.startTime,i.duration=e.duration,i.timeleft=util.hms2(e.startTime+e.duration-Math.floor((new Date).getTime()/1e3)),i.ending=e.startTime+e.duration,DirecTV.checkIfWorkerIsComplete()},error:function(){document.ajaxq.q[t].shift(),DirecTV.checkIfWorkerIsComplete()}})},checkIfWorkerIsComplete:function(){var e=!0;$.each(document.ajaxq.q,function(t){document.ajaxq.q[t].length>1&&t.indexOf("DTVWorker")>-1&&(e=!1)}),e===!0&&(workerTimer=setTimeout(function(){DirecTV.startWorker()},3e4))}},MediaBrowser={playByID:function(e,t){if(2==e&&DoShuffle(),1==e){var a=util.getMBUrl();a+="ui?command=play&id="+t,$.getJSON(a,function(){setTimeout(function(){ui.queryNowPlaying()},1500)})}},playTitle:function(e,t,a){if(util.isWifi()===!1)return util.doAlert("You are not on Wifi. To play this title, connect to Wifi and try again"),void 0;var i=util.getMBUrl(),n="";if(a)n=$(e).attr("data-guid"),i+="ui?command=play&id="+n,$.getJSON(i,function(){setTimeout(function(){ui.queryNowPlaying()},1500)}),util.doAlert("Now Playing\n"+t);else{var o=window.plugins.actionSheet,r=["Play","Resume","View on Screen"];"1"==$(e).attr("data-imdb")&&r.push("View Imdb Page"),r.push("Cancel"),n=$(e).attr("data-guid");var s="Actions";void 0!==s&&(s=t),o.create({title:s,items:r,destructiveButtonIndex:r.length-1},function(e,t){if(-1!=t&&t!=r.length-1){switch(r[t]){case"Play":i+="ui?command=play&id="+n;break;case"Resume":i+="ui?command=resume&id="+n;break;case"View on Screen":i+="ui?command=navigatetoitem&id="+n;break;case"View Imdb Page":i=""}""!==i?$.getJSON(i,function(){setTimeout(function(){ui.queryNowPlaying()},1500)}):$.ajax({url:util.getMBUrl()+"library/?Id="+n+"&lightData=1",dataType:"json",timeout:settings.userSettings.MBServiceTimeout,success:function(e){e.Data.ImdbID?(cb=window.plugins.childBrowser,null!==cb&&cb.showWebPage("http://m.imdb.com/title/"+e.Data.ImdbID)):util.doAlert("Sorry, This title does not have an IMBD id")},error:function(){parse&&util.doAlert("The server is not responding in time, and no cached version exists. Try again later")}})}})}},ShowItems:function(e,t){var a="click";t&&(a=t);var i=util.getMBUrl();util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var n=function(e){if("StartupFolder"==e.Data.Name)return MediaBrowser.createInitialListView(),void 0;var t=[];!settings.userSettings.moviesByDate||"Folder"!=e.Data.Type&&"FavoriteFolder"!=e.Data.Type||e.Data.Children.sort(function(e,t){return Date.parse(t.DateCreated)-Date.parse(e.DateCreated)}),!settings.userSettings.tvByDate||"Season"!=e.Data.Type&&"Series"!=e.Data.Type||e.Data.Children.sort(function(e,t){return Date.parse(t.DateCreated)-Date.parse(e.DateCreated)}),$.each(e.Data.Children,function(a){"Folder"==e.Data.Children[a].Type||"Season"==e.Data.Children[a].Type||"Series"==e.Data.Children[a].Type||"FavoriteFolder"==e.Data.Children[a].Type?t.push({textLabel:e.Data.Children[a].Name,detailTextLabel:""+e.Data.Children[a].ChildCount+" total, "+(e.Data.Children[a].UnwatchedCount?e.Data.Children[a].UnwatchedCount+" not watched, ":"")+e.Data.Children[a].RecentlyAddedUnplayedItemCount+" new",icon:"greyarrow",sectionHeader:"StartupFolder"==e.Data.Name?"Folders":e.Data.Children[0].Type,guid:e.Data.Children[a].Id,type:e.Data.Children[a].Type,imdb:e.Data.Children[a].ImdbRating>0?"1":"0"}):t.push({textLabel:(0===e.Data.Children[a].WatchedPercentage?"🔹 ":"")+e.Data.Children[a].Name+(e.Data.Children[a].ProductionYear?" ("+e.Data.Children[a].ProductionYear+")":""),detailTextLabel:(e.Data.Children[a].ImdbRating?e.Data.Children[a].ImdbRating+"/10 ":"")+(e.Data.Children[a].TagLine?e.Data.Children[a].TagLine:""),icon:"none",sectionHeader:"StartupFolder"==e.Data.Name?"Folders":e.Data.Children[0].Type,guid:e.Data.Children[a].Id,type:e.Data.Children[a].Type,imdb:e.Data.Children[a].ImdbRating>0?"1":"0"})});var a=window.plugins.NativeTable;a.createTable({height:$(window).height(),showSearchBar:!0,showNavBar:!0,navTitle:"StartupFolder"==e.Data.Name?"Folders":e.Data.Name,navBarColor:"black",showRightButton:!0,RightButtonText:"Close",showBackButton:"StartupFolder"!=e.Data.Name?!0:!1}),a.onRightButtonTap(function(){a.hideTable(function(){})}),a.setRowSelectCallBackFunction(function(e){var i=t[e];if("none"==i.icon){var n=$("<tr data-guid='"+i.guid+"' data-imdb='"+i.imdb+"'></tr>");MediaBrowser.playTitle($(n),i.textLabel,!1)}else a.hideTable(function(){MediaBrowser.ShowItems(i)})}),"StartupFolder"==e.Data.Name?a.onBackButtonTap(function(){}):a.onBackButtonTap(function(){a.hideTable(function(){MediaBrowser.ShowItems({type:"Folder",guid:e.Data.parentId})})}),a.setTableData(t),util.doHud({show:!1}),a.showTable(function(){})},o=function(e,t){return util.isWifi()===!1&&t?(util.doAlert("Sorry, you are not on Wifi, and this data is yet to be cached."),void 0):($.ajax({url:e,dataType:"json",timeout:settings.userSettings.MBServiceTimeout,success:function(a){null!==a.Data&&cache.saveJson(e,a),t&&n(a)},error:function(){t&&util.doAlert("The server is not responding in time, and no cached version exists. Try again later")}}),void 0)};if("CustomFolder"==e.type)switch(e.folderType){case"Genres":MediaBrowser.showListOfGenres();break;case"Years":MediaBrowser.showListOfYears();break;case"Actors":MediaBrowser.showListOfActors();break;case"Directors":MediaBrowser.showListOfDirectors();break;case"OfficialRating":MediaBrowser.showListOfRating();break;case"IMDBRating":MediaBrowser.showListOfIMDBRating();break;case"Unwatched":MediaBrowser.showListOfUnwatched()}else i+="library/?lightData=1&Id="+e.guid,cache.getJson(i,function(e){null===e?o(i,!0):(n(e),o(i,!1))})},createInitialListView:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=function(e){var t=[];$.each(e.Data.Children,function(a){t.push({textLabel:e.Data.Children[a].Name,detailTextLabel:""+e.Data.Children[a].ChildCount+" total, "+e.Data.Children[a].UnwatchedCount+" not watched, "+e.Data.Children[a].RecentlyAddedUnplayedItemCount+" new",icon:"greyarrow",sectionHeader:"Folders",guid:e.Data.Children[a].Id,type:e.Data.Children[a].Type,imdb:e.Data.Children[a].ImdbRating})}),geniusResults.allItems.length>0&&(t.push({textLabel:"Genres",detailTextLabel:"Movies Separated By Genre",icon:"greyarrow",sectionHeader:"Categories",type:"CustomFolder",folderType:"Genres"}),t.push({textLabel:"Rating",detailTextLabel:"Movies sorted by IMDB Rating",icon:"greyarrow",sectionHeader:"Categories",type:"CustomFolder",folderType:"IMDBRating"}),t.push({textLabel:"Release Year",detailTextLabel:"Movies Separated By Production Year",icon:"greyarrow",sectionHeader:"Categories",type:"CustomFolder",folderType:"Years"}),t.push({textLabel:"Unwatched",detailTextLabel:"Movies that have not been watched",icon:"greyarrow",sectionHeader:"Categories",type:"CustomFolder",folderType:"Unwatched"}),t.push({textLabel:"Actors",detailTextLabel:"Movie Actors",icon:"greyarrow",sectionHeader:"Categories",type:"CustomFolder",folderType:"Actors"}),t.push({textLabel:"Directors",detailTextLabel:"Movie Directors",icon:"greyarrow",sectionHeader:"Categories",type:"CustomFolder",folderType:"Directors"}),t.push({textLabel:"MPAA Rating",detailTextLabel:"Official rating by the MPAA",icon:"greyarrow",sectionHeader:"Categories",type:"CustomFolder",folderType:"OfficialRating"}));var a=window.plugins.NativeTable;a.createTable({height:$(window).height(),showSearchBar:!0,showNavBar:!0,navTitle:"Movies",navBarColor:"black",showRightButton:!0,RightButtonText:"Close",showBackButton:!1}),a.onRightButtonTap(function(){a.hideTable(function(){})}),a.setRowSelectCallBackFunction(function(e){var i=t[e];a.hideTable(function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."}),setTimeout(function(){MediaBrowser.ShowItems(i)},250)})}),a.setTableData(t),util.doHud({show:!1}),a.showTable(function(){})},t=function(t,a){return util.isWifi()===!1&&a?(util.doAlert("You are not on Wifi and no cached version exists. To do this, connect to Wifi and try again"),$("#btnTitles").trigger("click"),void 0):($.ajax({url:t,dataType:"json",timeout:settings.MBServiceTimeout,success:function(i){cache.saveJson(t,i),a&&e(i)},error:function(){a&&util.doAlert("The server is not responding in time, and no cached version exists. Try again later")}}),void 0)},a=util.getMBUrl();a+="library/",cache.getJson(a,function(i){null===i?t(a,!0):(e(i),t(a,!1))})},createCustomTable:function(e,t,a,i){var n=window.plugins.NativeTable;n.createTable({height:$(window).height(),showSearchBar:!0,showNavBar:!0,navTitle:t,navBarColor:"black",showRightButton:!0,RightButtonText:"Close",showBackButton:!0}),n.onRightButtonTap(function(){n.hideTable(function(){})}),n.setRowSelectCallBackFunction(function(e){i(e,n)}),n.onBackButtonTap(function(){n.hideTable(function(){a()})}),n.setTableData(e),util.doHud({show:!1}),n.showTable(function(){})},showListOfYears:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=[],t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];""!==i.ProductionYear&&null!==i.ProductionYear&&-1==jQuery.inArray(i.ProductionYear,t)&&(t.push(i.ProductionYear),e.push({textLabel:""+i.ProductionYear,detailTextLabel:"Movies Released in "+i.ProductionYear,icon:"greyarrow",sectionHeader:"Movies By Year",type:"CustomFolder",folderType:"Years"}))}),t=null,0===e.length?(util.doAlert("No Years found, this can happen if the app does not know enough about your library. You can try to leave the app open for a bit, while indexing occurs."),void 0):(e.sort(util.dynamicSort("-textLabel")),MediaBrowser.createCustomTable(e,"Years",function(){$("#btnTitles").trigger("click")},function(t,a){var i=e[t];a.hideTable(function(){MediaBrowser.showListOfMoviesByYear(i.textLabel)})}),void 0)},showListOfMoviesByYear:function(e){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];i.ProductionYear==e&&t.push({textLabel:(0===i.WatchedPercentage?"🔹 ":"")+i.Name+(i.ProductionYear?" ("+i.ProductionYear+")":""),detailTextLabel:(i.ImdbRating?i.ImdbRating+"/10 ":"")+(i.TagLine?i.TagLine:""),icon:"none",sectionHeader:i.SortName.substring(0,1).toUpperCase(),guid:i.Id,type:i.Type,imdb:i.ImdbRating>0?"1":"0",sortName:i.SortName})}),0===t.length?(util.doAlert("No movies found for this year."),void 0):(t.sort(util.dynamicSort("sortName")),MediaBrowser.createCustomTable(t,e,function(){MediaBrowser.showListOfYears()},function(e){var a=t[e],i=$("<tr data-guid='"+a.guid+"' data-imdb='"+a.imdb+"'></tr>");MediaBrowser.playTitle($(i),a.textLabel,!1)}),void 0)},showListOfGenres:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=[],t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(i.Genres)for(var n=0;i.Genres.length>n;n++)""!==i.Genres[n]&&null!==i.Genres[n]&&-1==jQuery.inArray(i.Genres[n],t)&&(t.push(i.Genres[n]),e.push({textLabel:i.Genres[n],detailTextLabel:""+i.Genres[n]+" movies",icon:"greyarrow",sectionHeader:"Movies By Genre",type:"CustomFolder",folderType:"Genres"}))}),t=null,0===e.length?(util.doAlert("No Genres found, this can happen if the app does not know enough about your library. You can try to leave the app open for a bit, while indexing occurs."),void 0):(e.sort(util.dynamicSort("textLabel")),MediaBrowser.createCustomTable(e,"Genres",function(){$("#btnTitles").trigger("click")},function(t,a){var i=e[t];a.hideTable(function(){MediaBrowser.showListOfMoviesByGenre(i.textLabel)})}),void 0)},showListOfMoviesByGenre:function(e){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(i.Genres)for(var n=0;i.Genres.length>n;n++)i.Genres[n]==e&&t.push({textLabel:(0===i.WatchedPercentage?"🔹 ":"")+i.Name+(i.ProductionYear?" ("+i.ProductionYear+")":""),detailTextLabel:(i.ImdbRating?i.ImdbRating+"/10 ":"")+(i.TagLine?i.TagLine:""),icon:"none",sectionHeader:i.SortName.substring(0,1).toUpperCase(),guid:i.Id,type:i.Type,imdb:i.ImdbRating>0?"1":"0",sortName:i.SortName})}),0===t.length?(util.doAlert("No movies found for this genre."),void 0):(t.sort(util.dynamicSort("sortName")),MediaBrowser.createCustomTable(t,e,function(){MediaBrowser.showListOfGenres()},function(e){var a=t[e],i=$("<tr data-guid='"+a.guid+"' data-imdb='"+a.imdb+"'></tr>");MediaBrowser.playTitle($(i),a.textLabel,!1)}),void 0)},showListOfActors:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=[],t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(i.Actors)for(var n=0;i.Actors.length>n;n++)if(""!==$.trim(i.Actors[n].Name)&&null!==i.Actors[n].Name&&-1==jQuery.inArray(i.Actors[n].Name,t)){t.push(i.Actors[n].Name);var o=i.Actors[n].Name.split(" ").pop().replace(/[^a-zA-Z 0-9]+/g,"");o+=", "+i.Actors[n].Name.split(" ")[0].replace(/[^a-zA-Z 0-9]+/g,""),e.push({textLabel:o,detailTextLabel:"",icon:"greyarrow",sectionHeader:o.substring(0,1).toUpperCase(),type:"CustomFolder",folderType:"Actors",customSort:o,ActualName:i.Actors[n].Name})}}),t=null,0===e.length?(util.doAlert("No Actors found, this can happen if the app does not know enough about your library. You can try to leave the app open for a bit, while indexing occurs."),void 0):(e.sort(util.dynamicSort("customSort")),MediaBrowser.createCustomTable(e,"Actors",function(){$("#btnTitles").trigger("click")},function(t,a){var i=e[t];a.hideTable(function(){MediaBrowser.showListOfMoviesByActor(i.ActualName)})}),void 0)},showListOfMoviesByActor:function(e){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(i.Actors)for(var n=0;i.Actors.length>n;n++)i.Actors[n].Name==e&&t.push({textLabel:(0===i.WatchedPercentage?"🔹 ":"")+i.Name+(i.ProductionYear?" ("+i.ProductionYear+")":""),detailTextLabel:(i.ImdbRating?i.ImdbRating+"/10 ":"")+(i.TagLine?i.TagLine:""),icon:"none",sectionHeader:i.SortName.substring(0,1).toUpperCase(),guid:i.Id,type:i.Type,imdb:i.ImdbRating>0?"1":"0",sortName:i.SortName})}),0===t.length?(util.doAlert("No movies found for this actor."),void 0):(t.sort(util.dynamicSort("sortName")),MediaBrowser.createCustomTable(t,e,function(){MediaBrowser.showListOfActors()},function(e){var a=t[e],i=$("<tr data-guid='"+a.guid+"' data-imdb='"+a.imdb+"'></tr>");MediaBrowser.playTitle($(i),a.textLabel,!1)}),void 0)},showListOfDirectors:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=[],t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(i.Directors)for(var n=0;i.Directors.length>n;n++)if(""!==$.trim(i.Directors[n].Name)&&null!==i.Directors[n]&&-1==jQuery.inArray(i.Directors[n],t)){t.push(i.Directors[n]);var o=i.Directors[n].split(" ").pop().replace(/[^a-zA-Z 0-9]+/g,"");o+=", "+i.Directors[n].split(" ")[0].replace(/[^a-zA-Z 0-9]+/g,""),e.push({textLabel:o,detailTextLabel:"",icon:"greyarrow",sectionHeader:o.substring(0,1).toUpperCase(),type:"CustomFolder",folderType:"Directors",customSort:o,ActualName:i.Directors[n]})}}),t=null,0===e.length?(util.doAlert("No Directors found, this can happen if the app does not know enough about your library. You can try to leave the app open for a bit, while indexing occurs."),void 0):(e.sort(util.dynamicSort("customSort")),MediaBrowser.createCustomTable(e,"Directors",function(){$("#btnTitles").trigger("click")},function(t,a){var i=e[t];a.hideTable(function(){MediaBrowser.showListOfMoviesByDirector(i.ActualName)})}),void 0)},showListOfMoviesByDirector:function(e){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(i.Directors)for(var n=0;i.Directors.length>n;n++)i.Directors[n]==e&&t.push({textLabel:(0===i.WatchedPercentage?"🔹 ":"")+i.Name+(i.ProductionYear?" ("+i.ProductionYear+")":""),detailTextLabel:(i.ImdbRating?i.ImdbRating+"/10 ":"")+(i.TagLine?i.TagLine:""),icon:"none",sectionHeader:i.SortName.substring(0,1).toUpperCase(),guid:i.Id,type:i.Type,imdb:i.ImdbRating>0?"1":"0",sortName:i.SortName})}),0===t.length?(util.doAlert("No movies found for this Director."),void 0):(t.sort(util.dynamicSort("sortName")),MediaBrowser.createCustomTable(t,e,function(){MediaBrowser.showListOfDirectors()},function(e){var a=t[e],i=$("<tr data-guid='"+a.guid+"' data-imdb='"+a.imdb+"'></tr>");MediaBrowser.playTitle($(i),a.textLabel,!1)}),void 0)},showListOfRating:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=[],t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];""!==i.OfficialRating&&null!==i.OfficialRating&&-1==jQuery.inArray(i.OfficialRating,t)&&(t.push(i.OfficialRating),e.push({textLabel:""+i.OfficialRating,detailTextLabel:"Movies Rated: "+i.OfficialRating,icon:"greyarrow",sectionHeader:"Movies By MPAA Rating",type:"CustomFolder",folderType:"Rating"}))}),t=null,0===e.length?(util.doAlert("No Ratings found, this can happen if the app does not know enough about your library. You can try to leave the app open for a bit, while indexing occurs."),void 0):(e.sort(util.dynamicSort("textLabel")),MediaBrowser.createCustomTable(e,"Rating",function(){$("#btnTitles").trigger("click")},function(t,a){var i=e[t];a.hideTable(function(){MediaBrowser.showListOfMoviesByRating(i.textLabel)})}),void 0)},showListOfMoviesByRating:function(e){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];i.OfficialRating==e&&t.push({textLabel:(0===i.WatchedPercentage?"🔹 ":"")+i.Name+(i.ProductionYear?" ("+i.ProductionYear+")":""),detailTextLabel:(i.ImdbRating?i.ImdbRating+"/10 ":"")+(i.TagLine?i.TagLine:""),icon:"none",sectionHeader:i.SortName.substring(0,1).toUpperCase(),guid:i.Id,type:i.Type,imdb:i.ImdbRating>0?"1":"0",sortName:i.SortName})}),0===t.length?(util.doAlert("No movies found for this rating."),void 0):(t.sort(util.dynamicSort("sortName")),MediaBrowser.createCustomTable(t,e,function(){MediaBrowser.showListOfRating()},function(e){var a=t[e],i=$("<tr data-guid='"+a.guid+"' data-imdb='"+a.imdb+"'></tr>");MediaBrowser.playTitle($(i),a.textLabel,!1)}),void 0)},showListOfIMDBRating:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=[],t=[];return $.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(util.isNumeric(i.ImdbRating)&&i.ImdbRating>0){var n=Math.floor(i.ImdbRating);-1==jQuery.inArray(n,t)&&(t.push(n),e.push({textLabel:n+" stars",detailTextLabel:"Movies with greater or equal to "+n+" stars",icon:"greyarrow",sectionHeader:"Movies By Rank",type:"CustomFolder",folderType:"imdbRating",imdbRating:""+n,sortOn:(10>n?"0":"")+n}))}}),t=null,0===e.length?(util.doAlert("No imdb ratings found, this can happen if the app does not know enough about your library. You can try to leave the app open for a bit, while indexing occurs."),void 0):(e.sort(util.dynamicSort("-sortOn")),MediaBrowser.createCustomTable(e,"Rating",function(){$("#btnTitles").trigger("click")},function(t,a){var i=e[t];a.hideTable(function(){MediaBrowser.showListOfMoviesByIMDBRating(i.imdbRating)})}),void 0)},showListOfMoviesByIMDBRating:function(e){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var t=[];return e=parseInt(e,10),$.each(geniusResults.allItems,function(a){var i=geniusResults.allItems[a];if(util.isNumeric(i.ImdbRating)&&i.ImdbRating>0){var n=Math.floor(i.ImdbRating);n==e&&t.push({textLabel:(0===i.WatchedPercentage?"🔹 ":"")+i.Name+(i.ProductionYear?" ("+i.ProductionYear+")":""),detailTextLabel:(i.ImdbRating?i.ImdbRating+"/10 ":"")+(i.TagLine?i.TagLine:""),icon:"none",sectionHeader:i.SortName.substring(0,1).toUpperCase(),guid:i.Id,type:i.Type,imdb:i.ImdbRating>0?"1":"0",sortName:i.SortName})}}),0===t.length?(util.doAlert("No movies found for this rating."),void 0):(t.sort(util.dynamicSort("sortName")),MediaBrowser.createCustomTable(t,e.toString,function(){MediaBrowser.showListOfIMDBRating()},function(e){var a=t[e],i=$("<tr data-guid='"+a.guid+"' data-imdb='"+a.imdb+"'></tr>");MediaBrowser.playTitle($(i),a.textLabel,!1)}),void 0)},showListOfUnwatched:function(){util.doHud({show:!0,labelText:"Loading Data...",detailsLabelText:"Please Wait..."});var e=[];return $.each(geniusResults.allItems,function(t){var a=geniusResults.allItems[t];0===a.WatchedPercentage&&e.push({textLabel:(0===a.WatchedPercentage?"🔹 ":"")+a.Name+(a.ProductionYear?" ("+a.ProductionYear+")":""),detailTextLabel:(a.ImdbRating?a.ImdbRating+"/10 ":"")+(a.TagLine?a.TagLine:""),icon:"none",sectionHeader:a.SortName.substring(0,1).toUpperCase(),guid:a.Id,type:a.Type,imdb:a.ImdbRating>0?"1":"0",sortName:a.SortName})}),0===e.length?(util.doAlert("No unwatched movies found."),void 0):(e.sort(util.dynamicSort("sortName")),MediaBrowser.createCustomTable(e,"Unwatched",function(){$("#btnTitles").trigger("click")},function(t){var a=e[t],i=$("<tr data-guid='"+a.guid+"' data-imdb='"+a.imdb+"'></tr>");MediaBrowser.playTitle($(i),a.textLabel,!1)}),void 0)},startWorker:function(){var e=new Date,t=util.getItem("lastRefresh");t=null===t?new Date("2010-01-01T23:44:52.790Z"):new Date(t);var a=(e.getTime()-t.getTime())/6e4,i=!1;a>2880&&(i=!0),cache.getJson("genius",function(e){if(null!==e&&(geniusResults=e),geniusResults.refreshQueue.length>0)return MediaBrowser.processGeniusQueue(),void 0;if(i!==!1){util.setItem("lastRefresh",(new Date).toISOString());var t=util.getRandomMBServer();t+="library",util.setStatusBarMessage("Requesing All Metadata"),$.ajax({url:t,dataType:"json",timeout:3e6,success:function(e){$.each(e.Data.Children,function(t){var a=e.Data.Children[t];"Folder"==a.Type&&geniusResults.refreshQueue.push({Id:a.Id,title:a.Name})}),cache.saveJson("genius",geniusResults),MediaBrowser.processGeniusQueue()}})}})},processGeniusQueue:function(){util.setStatusBarMessage(geniusResults.refreshQueue.length+" items in queue"),MBUrl=util.getRandomMBServer(),$.each(geniusResults.refreshQueue,function(e){console.log(MBUrl+"library?lightData=0&Id="+geniusResults.refreshQueue[e].Id),$.ajaxq("geniusWorker",{url:MBUrl+"library?lightData=0&Id="+geniusResults.refreshQueue[e].Id,dataType:"json",timeout:3e6,success:function(t){util.setStatusBarMessage(geniusResults.refreshQueue[e].title+" complete"),geniusResults.refreshQueue.splice(e,1),MediaBrowser.saveGeniusResults(t),0===geniusResults.refreshQueue.length&&util.setStatusBarMessage("All Metadata refreshed")}})})},saveGeniusResults:function(e){var t=function(e){var t=!1;return $.each(geniusResults.allItems,function(a){return geniusResults.allItems[a].Id==e?(t=!0,!1):void 0}),t};$.each(e.Data.Children,function(a){var i=e.Data.Children[a];"Movie"==i.Type&&t(i.Id)===!1&&geniusResults.allItems.push(i)}),cache.saveJson("genius",geniusResults)}},bottomDraw={bind:function(){var e=null;$("#boxCoverContainer").bind("scroll",function(){clearTimeout(e),e=setTimeout(function(){var e=util.getCurrentDevice();if("MCE"==e.shortname){var t=$(this).width();$("#covers > div.pendingImg").each(function(){var e=$(this).offset().left,a=$(this).width(),i=!1;if(i=0>e+a?!1:e>t?!1:!0,i===!0){$(this).removeClass("pendingImg");var n=$(this).find("img"),o=$(n).attr("data-guid"),r=$(n).attr("data-prefix"),s="MB_Small_"+o;$(n).onerror=function(){$(this).attr("src","img/nobox.png")},cache.getImage({id:s,url:r+o+"&maxwidth=120&maxheight=120"},function(e){var t=new Image;t.onerror=function(){$(n).attr("src","img/nobox.png")},e.cached===!1?(t.onload=function(){cache.saveImage({id:s,img:t}),$(n).attr("src",e.url)},t.src=e.url):$(n).attr("src",e.url)})}})}},200)}),$("#boxCoverContainer").bind("touchmove touchend",function(){window.scrollTo(0,0)}),$("#boxCoverBack").fastClick(function(){if(""!==$("#covers").data("back"))if("ChannelHome"==$("#covers").data("back"))bottomDraw.showBottomItems();else{var e=$("<a data-guid='"+$("#covers").data("back")+"' data-type='Folder' data-backwards='1' />");bottomDraw.showBottomItems(e)}}),$("#bottomGrabber").bind("touchstart",function(e){e.originalEvent.touches[0].screenY,$(this).data("lastY",e.originalEvent.touches[0].screenY)}),$("#bottomGrabber").bind("touchmove",function(e){e.stopImmediatePropagation(),e.preventDefault();var t=e.originalEvent.targetTouches[0],a=parseInt($(this).data("lastY"),10),i=parseInt($("#bottom").css("bottom"),10),n=140,o=0,r=-140;$(this).data("lastY",t.pageY),t.screenY>a?(o=i-(t.pageY-a),n>=o&&o>=0&&($("#bottom").css("bottom",o+"px"),$("#browser").css("bottom",r+o+"px"))):(o=i+(a-t.pageY),n>=o&&o>=0&&($("#bottom").css("bottom",o+"px"),$("#browser").css("bottom",r+o+"px")))}),$("#bottomGrabber").bind("touchend",function(){setTimeout(function(){bottomDraw.refreshBottomDrawer()},100)})},showBottomItems:function(e,t){var a="click";t&&(a=t);var i=util.getCurrentDevice(),n=70,o=!1,r={startCoverOpacity:.25,startCoverTop:"140px",endCoverOpacity:1,endCoverTop:"24px"};if("MCE"==i.shortname){var s=util.getMBUrl();if(e){if("Movie"==$(e).attr("data-type")||"Episode"==$(e).attr("data-type"))return"taphold"==a?MediaBrowser.playTitle($(e),$(e).parent().find("p").text(),!1):MediaBrowser.playTitle($(e),$(e).parent().find("p").text(),!0),void 0;$(e).hasAttr("data-backwards")&&(o=!0)}o&&(r={startCoverOpacity:.25,startCoverTop:"-164px",endCoverOpacity:1,endCoverTop:"24px"}),$("#covers").animate({opacity:r.startCoverOpacity,"margin-top":r.startCoverTop},250,function(){$("#covers").css("margin-top","24px").width($(window).width()),$("#covers").html("<div class='boxLoader'><p class='boxLoading'>Loading Data...</p></div>").css("opacity","1").hide().fadeIn();var t=function(e){var t='<div style="width: 40px; height: 100%; float:left"> </div>';$("#covers").width(e.Data.Children.length*n+50),settings.moviesByDate&&"Folder"==e.Data.Type&&e.Data.Children.sort(function(e,t){return Date.parse(t.DateCreated)-Date.parse(e.DateCreated)}),!settings.userSettings.tvByDate||"Season"!=e.Data.Type&&"Series"!=e.Data.Type||e.Data.Children.sort(function(e,t){return Date.parse(t.DateCreated)-Date.parse(e.DateCreated)}),$.each(e.Data.Children,function(a){t+='<div class="smallboxContainer pendingImg" >',e.Data.Children[a].IsFolder===!0&&e.Data.Children[a].RecentlyAddedUnplayedItemCount>0&&(t+='<div class="badge" >'+e.Data.Children[a].RecentlyAddedUnplayedItemCount+"</div>"),t+='<img data-prefix="'+util.getMBUrl()+"image/?Id="+'" data-guid="'+e.Data.Children[a].Id+'" data-type="'+e.Data.Children[a].Type+'" class="smallBox" src="img/nobox.png"  data-imdb="'+(e.Data.Children[a].ImdbRating>0?"1":"0")+'" />',t+="<p>"+e.Data.Children[a].Name+"</p>",t+="</div>"});var a=$("<div>"+t+"</div>");$(a).find("div.pendingImg").each(function(e){if(e>100)return!1;var t=$(this).find("img"),a=$(t).attr("data-guid"),i=$(t).attr("data-prefix"),n="MB_Small_"+a;$(t).onerror=function(){$(this).attr("src","img/nobox.png")},cache.getImage({id:n,url:i+a+"&maxwidth=120&maxheight=120"},function(e){var a=new Image;a.onerror=function(){$(t).attr("src","img/nobox.png")},e.cached&&($(t).attr("src",e.url),$(this).removeClass("pendingImg"))})}),$("#covers").css("margin-top","-130px").css("opacity","0.25"),$("#covers").empty().append($(a).children()),$("#covers img").each(function(){var e=$(this).attr("data-type");"Movie"==e||"Episode"==e?($(this).longclick(function(e){bottomDraw.showBottomItems(e.currentTarget,"taphold")},750),$(this).bind("click",function(){bottomDraw.showBottomItems($(this))})):$(this).bind("click",function(){$("#boxCoverBack").data("scrollPosition",$("#boxCoverContainer").scrollLeft()),bottomDraw.showBottomItems($(this))})}),$("#covers").animate({opacity:r.endCoverOpacity,"margin-top":r.endCoverTop},250,function(){$("#boxCoverBack").data("scrollPosition")&&o&&$("#boxCoverContainer").animate({scrollLeft:parseInt($("#boxCoverBack").data("scrollPosition"),10)},500),$("#boxCoverContainer").trigger("scroll");var t=e.Data.Name;"StartupFolder"==t?(t="Startup Folder",$("#covers").data("back","")):$("#covers").data("back",e.Data.parentId),$("#covers").data("loaded",!0),$("#bottomText > span:first").animate({opacity:0,"margin-left":"-100px"},250,function(){$("#bottomText > span:first").text(t),$("#bottomText > span:first").animate({opacity:1,"margin-left":"0px"},250)})})},a=function(e,a){return util.isWifi()===!1&&a?(util.doAlert("Sorry, you are not on Wifi, and this data is yet to be cached."),$("#covers").html("<div class='boxLoader'><p class='boxLoading'>No data found.</p></div>"),void 0):($.ajax({url:e,dataType:"json",timeout:settings.MBServiceTimeout,success:function(i){cache.saveJson(e,i),a&&t(i)},error:function(){a&&(util.doAlert("The server is not responding in time, and no cached version exists. Try again later"),$("#covers").html("<div class='boxLoader'><p class='boxLoading'>No data found.</p></div>"))}}),void 0)};s+=e?"library/?lightData=1&Id="+$(e).attr("data-guid"):"library/",cache.getJson(s,function(e){null===e?a(s,!0):(t(e),a(s,!1))})})}if("DTV"==i.shortname){if(e){if("Movie"==$(e).attr("data-type")||"Episode"==$(e).attr("data-type"))return MediaBrowser.playTitle($(e),$(e).parent().find("p").text()),void 0;$(e).hasAttr("data-backwards")&&(o=!0)}r={startCoverOpacity:.25,startCoverTop:"140px",endCoverOpacity:1,endCoverTop:"24px"},o&&(r={startCoverOpacity:.25,startCoverTop:"-164px",endCoverOpacity:1,endCoverTop:"24px"}),$("#covers").animate({opacity:r.startCoverOpacity,"margin-top":r.startCoverTop},250,function(){$("#covers").css("margin-top","24px").width($(window).width()),$("#covers").html("<div class='boxLoader'><p class='boxLoading'>Loading Data...</p></div>").css("opacity","1").hide().fadeIn();
var t='<div style="width: 40px; height: 100%; float:left"> </div>';if(e){var a=$(e).attr("data-category"),i=0;$.each(guide.channels,function(e,n){n.category==a&&(t+='<div class="smallboxContainer" >',t+='<div class="channelContainer"><div data-minor="'+n.number+'" class="smallChannel" style="background-image: url('+n.logo+')" ></div></div>',t+="<p>"+n.fullname+"</p>",t+="</div>",i++)}),$("#covers").width(i*n+50)}else{var s=[];$.each(guide.channels,function(e,t){var a={category:t.category,logo:t.logo,name:t.fullname},i=!1;$.each(s,function(e,a){return a.category==t.category?(i=!0,!1):void 0}),i===!1&&s.push(a)}),$.each(s,function(e,a){t+='<div class="smallboxContainer" >',t+='<div class="channelContainer"><div data-category="'+a.category+'" class="smallChannel" style="background-image: url('+a.logo+')" ></div></div>',t+="<p>"+a.category+"</p>",t+="</div>"}),$("#covers").width(s.length*n+50)}var l=$("<div>"+t+"</div>");$("#covers").css("margin-top","-130px").css("opacity","0.25"),$("#covers").empty().append($(l).children()),$("#covers div.smallChannel").fastClick(function(){$(this).hasAttr("data-category")?($("#boxCoverBack").data("scrollPosition",$("#boxCoverContainer").scrollLeft()),bottomDraw.showBottomItems($(this))):DirecTV.changeChannel($(this).attr("data-minor"))}),$("#covers").animate({opacity:r.endCoverOpacity,"margin-top":r.endCoverTop},250,function(){$("#boxCoverBack").data("scrollPosition")&&o&&$("#boxCoverContainer").animate({scrollLeft:parseInt($("#boxCoverBack").data("scrollPosition"),10)},500);var t="Categories";e?($("#covers").data("back","ChannelHome"),t=$(e).attr("data-category")):$("#covers").data("back",""),$("#covers").data("loaded",!0),$("#bottomText > span:first").animate({opacity:0,"margin-left":"-100px"},250,function(){$("#bottomText > span:first").text(t),$("#bottomText > span:first").animate({opacity:1,"margin-left":"0px"},250)})})})}},refreshBottomDrawer:function(){var e=140,t=parseInt($("#bottom").css("bottom"),10);t>e/3?($("#bottom").animate({bottom:"140px"},{duration:200,queue:!1}),$("#browser").animate({bottom:"-1px"},{duration:200,queue:!1,complete:function(){""!==$("#covers").data("back")&&void 0!==$("#covers").data("back")||$("#covers").data("loaded")!==!1&&void 0!==$("#covers").data("loaded")||bottomDraw.showBottomItems()}})):($("#bottom").animate({bottom:"0px"},{duration:200,queue:!1}),$("#browser").animate({bottom:"-140px"},{duration:200,queue:!1,complete:function(){(""===$("#covers").data("back")||void 0===$("#covers").data("back"))&&($("#covers").data("loaded",!1),$("#bottomText span").html("&nbsp;"),$("#covers").html("&nbsp;"))}}))},updateBottomContents:function(){$("#covers").data("back",""),$("#covers").data("loaded",!1),$("#bottomText span").html("&nbsp;"),$("#covers").html("&nbsp;"),bottomDraw.refreshBottomDrawer()}},cache={clear:function(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(e){var t=e.root.createReader();t.readEntries(function(e){for(i=0;e.length>i;i++)e[i].remove(null,null)},function(){})},function(){console.log("Pull cache Error, no access to file system"),callback({cached:!1,url:request.url})})},getImage:function(e,t){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(a){a.root.getFile(e.id+".cache",{create:!1,exclusive:!1},function(a){a.file(function(e){var a=new FileReader;a.onloadend=function(e){t({cached:!0,url:""+e.target.result})},a.readAsText(e)},function(){console.log("Error reading Cached File"),t({cached:!1,url:e.url})})},function(){t({cached:!1,url:e.url})})},function(){console.log("Pull cache Error, no access to file system"),t({cached:!1,url:e.url})})},saveImage:function(e){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(t){t.root.getFile(e.id+".cache",{create:!0,exclusive:!1},function(t){t.createWriter(function(t){t.onwriteend=function(){},t.write(cache.getBase64Image(e.img))},function(){console.log("Write to Cache Error")})},function(){console.log("Error initiating cached file")})},function(){console.log("Save cache Error, no access to file system")})},getBase64Image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var a=t.getContext("2d");a.drawImage(e,0,0);var i=t.toDataURL("image/png");return i},getJson:function(e,t){var a=e.replace("http://","");a=a.substring(a.indexOf("/")+1),a=a.replace(/\//g,"-"),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(e){e.root.getFile(a+".json",{create:!1,exclusive:!1},function(e){e.file(function(e){var a=new FileReader;a.onloadend=function(e){t(jQuery.parseJSON(""+e.target.result))},a.readAsText(e)},function(){console.log("Error reading Cached File"),t(null)})},function(){t(null)})},function(){console.log("Pull cache Error, no access to file system"),t(null)})},saveJson:function(e,t){if(null!==t){var a=e.replace("http://","");a=a.substring(a.indexOf("/")+1),a=a.replace(/\//g,"-"),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(e){e.root.getFile(a+".json",{create:!0,exclusive:!1,append:!1},function(e){e.createWriter(function(e){e.onwriteend=function(){},e.write(JSON.stringify(t))},function(){console.log("Write to Cache Error")})},function(){console.log("Error initiating cached json file")})},function(){console.log("Save cache Error, no access to file system")})}}},gestures={executeGestureByCommandName:function(e){var t=util.getCurrentRoom(),a=util.getCurrentDevice(),i=$(xml).find("gesturePad > rooms > room[index='"+t.index+"'] ~ roomgestures > gesture > device > command > name:contains('"+e+"'):first");if($(i).size()>0){var n=$(i).parent().parent().attr("shortname");$(xml).find("gesturePad > devices > device[shortname='"+n+"'] > commands > category > command > name:contains('"+e+"'):first").each(function(){actionNodes=$(this).parent().find("action"),a=util.getDeviceByShortName(n),gestures.doEvent("manual",actionNodes,a)})}else{var o=$(xml).find("gesturePad > devices > device[shortname='"+a.shortname+"'] > commands > category > command > name:contains('"+e+"'):first");1==$(o).size()&&(actionNodes=$(o).next(),gestures.doEvent("manual",actionNodes,a))}},doEvent:function(e,t,a){if(window.scrollTo(0,0),util.isWifi()===!1)return util.doAlert("You are not on Wifi. Connect to Wifi and try again"),void 0;util.clearCallers(!1);var i=!0;0===$("#gestures_canvas:visible").size()&&(i=!1);var n=$("<div class='message' style='display:none' data-gest='"+e+"'><span class='i'></span> <span class='t'>"+e+"</span></div>");i&&$("#gestureCallback").append(n);var o=util.getCurrentRoom(),r=util.getCurrentDevice();a!==void 0&&(r=a);var s=!0,l=!1,c=null;if("manual"!=e?($(xml).find("gesturePad > rooms > room[index='"+o.index+"'] ~ roomgestures > gesture[definition='"+e+"'] > device:first").each(function(){var e=$(this).attr("shortname"),t=$(this).find("command > name").text();$(xml).find("gesturePad > devices > device[shortname='"+e+"'] > commands > category > command > name:contains('"+t+"'):first").each(function(){l=!0,s=!0,c=$(this).parent().find("action"),r=util.getDeviceByShortName(e)})}),l===!1&&$(xml).find("gesturePad > devices > device[shortname='"+r.shortname+"'] > commands > category > command > gesture[definition='"+e+"']:first").each(function(){s=!0,c=$(this).parent().find("action")})):c=$(t),null===c&&(s=!1),s){util.playBeep();var u=$(c).parent().find("name:first").text();$(n).find("span.t").text(u+" - "+$(n).attr("data-gest")),$(n).find("span.i").text("🔄"),$(n).show(),$(n).animate({opacity:1,width:"100%"},250,function(){var e=$(c).size()-1;$(c).each(function(t){var a=$(c),i="http://"+r.IPAddress+":"+r.Port+"/";$(this).find("addtobaseurl:first").each(function(){i+=$(this).text()}),$(this).find("replacebaseurl:first").each(function(){i=$(this).text()}),$.ajax({type:$(this).find("method:first").text(),url:i,data:$(this).find("data:first").text()+appendOncetoQueryString,timeout:6e4,dataType:$(this).find("dataType:first").text(),success:function(){appendOncetoQueryString="",t==e&&($(n).find("span.i").text("✅"),$(n).animate({opacity:0,width:"0%"},250,function(){$(a).find("onCompleteSetDevice").size()>0&&(util.setDeviceByShortName($(a).find("onCompleteSetDevice").attr("shortname")),util.updateStatus()),$(n).hide().remove()})),("Stop"==u||u.indexOf("channel")>-1)&&ui.clearNowPlaying(),setTimeout(function(){ui.queryNowPlaying()},1500)},error:function(){appendOncetoQueryString="",t==e&&($(n).find("span.i").text("❌"),$(n).animate({opacity:0,width:"0%"},250,function(){$(a).find("onCompleteSetDevice").size()>0&&(util.setDeviceByShortName($(a).find("onCompleteSetDevice").attr("shortname")),util.updateStatus()),$(n).hide().remove()}))}})})})}else $(n).find("span.i").text("❌"),$(n).find("span.t").text("Unassigned - "+$(n).attr("data-gest")),$(n).show(),$(n).animate({opacity:1,width:"100%"},250,function(){$(n).delay(500).animate({opacity:0,width:"0%"},500,function(){$(n).remove()})})}},xml,appSettings,appendOncetoQueryString="",npTimer,inputTimer,clickEventType,slideTimer,guide={},workerTimer=null,sleepTimer=null,scrollstop=null,geniusResults={refreshQueue:[],allItems:[]},init={PhoneGapReady:function(){document.addEventListener("deviceready",init.onDeviceReady,!1),document.addEventListener("resume",init.onResume,!1),document.addEventListener("pause",init.onBackground,!1),window.onorientationchange=util.detectOrientation,window.onresize=util.detectOrientation,window.onerror=function(e,t,a){console.log("\n\n"+e+"\n"+t+"\nline "+a+"\n\n\n")}},onDeviceReady:function(){util.splash("show"),$.gestures.init(),$.gestures.retGesture(function(e){gestures.doEvent(e)}),util.doResize(),notify.init(),notify.clearAllBadges(),ui.initiateBindings(),settings.loadSettings(),settings.userSettings.isSetup!==!1&&(MediaBrowser.startWorker(),npTimer=setInterval(function(){ui.queryNowPlaying(),util.getRoomStatus()},3e4),window.scrollTo(0,0))},onResume:function(){settings.checkSettingsForUpdate(),clearAllBadges(),util.getRoomStatus(),SleepDevice(!1),DirecTV.startWorker(),MediaBrowser.startWorker(),ui.queryNowPlaying(),npTimer=setInterval(function(){ui.queryNowPlaying()},3e4)},onBackground:function(){clearInterval(npTimer)},loadXML:function(){var e=settings.userSettings.configURL+"?r="+Math.random();$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){xml=e,util.setItem("configURL",settings.userSettings.configURL)},error:function(){util.splash("hide"),util.doAlert("Error loading xml settings: "+e)}})}},notify={init:function(){var e=window.plugins.pushNotification;e.registerDevice({alert:!0,badge:!0,sound:!1},function(){})},clearAllBadges:function(){var e=window.plugins.pushNotification;e.setApplicationIconBadgeNumber(0,function(){}),e.cancelAllLocalNotifications(function(){})}},settings={userSettings:{},loadSettings:function(){settings.userSettings=settings.getSettingsObject(),settings.userSettings.deviceIndex=util.getItem("deviceIndex",0),settings.userSettings.roomIndex=util.getItem("roomIndex",0),(util.isNumeric(settings.userSettings.roomIndex)===!1||util.isNumeric(settings.userSettings.deviceIndex)===!1)&&(util.setItem("roomIndex",0),util.setItem("deviceIndex",0),settings.userSettings.roomIndex=0,settings.userSettings.deviceIndex=0),DirecTV.hasDirecTV()&&DirecTV.loadChannelList(),util.setItem("configURL",""),util.getItem("configURL","")!=settings.userSettings.configURL&&init.loadXML(),util.updateStatus(),util.getRoomStatus(),setTimeout(function(){util.splash("hide")},500)},getSettingsObject:function(){var e={sounds:!1,vibrate:!1,wifi:!0,SleepThreshold:6e4,MBServiceTimeout:12e4,moviesByDate:!1,tvByDate:!1,configURL:"mbeg.xml",roomIndex:0,deviceIndex:0,isSetup:!0,rooms:[]};return window.plugins.applicationPreferences.get("All",function(t){var a=!1;appSettings=t;var i=jQuery.parseJSON(t);1==i.sounds&&(e.sounds=!0),1==i.vibrate&&(e.vibrate=!0),0===i.wifi&&(e.wifi=!1),1==i.dateMovies&&(e.moviesByDate=!0),1==i.dateTV&&(e.tvByDate=!0),1==i.config_source?e.configURL="mbeg.xml":2==i.config_source?e.configURL="mbegdt.xml":3==i.config_source&&(e.configURL=i.custom_config);for(var n=1;5>=n;n++)if(i["S"+n+"_enabled"]&&1==i["S"+n+"_enabled"]){a=!0;var o={name:"Room "+n,index:n-1,DTV:null,IR:!1,devices:[]};o.name=i["S"+n+"_RoomName"],o.devices.push({name:"Movies",shortname:"MCE",IPAddress:i["S"+n+"_IP"],Port:i["S"+n+"_EGPort"],ServicePort:i["S"+n+"_MBPort"],timeshift:!0,index:0}),1==i["S"+n+"_DTV"]&&(o.DTV=i["S"+n+"_DTVIP"],o.devices.push({name:"Television",shortname:"DTV",IPAddress:i["S"+n+"_DTVIP"],Port:8080,timeshift:!1,index:1})),1==i["S"+n+"_EG"]&&(o.IR=!0),e.rooms.push(o)}a===!1&&(e.isSetup=!1,util.doAlert("No Servers are defined. Go to settings to add a server."),util.splash("hide")),e.roomIndex=util.getItem("roomIndex",0),e.deviceIndex=util.getItem("deviceIndex",0)}),e},checkSettingsForUpdate:function(){window.plugins.applicationPreferences.get("All",function(e){e!=appSettings&&(util.doAlert("Your settings have changed. Quit the app from the app switcher to reload."),util.reloadPage())})}},sliders={bindSliders:function(){$("#VolumeSliderSeek").bind("touchmove",function(e){e.preventDefault(),clearTimeout(slideTimer);var t=e.originalEvent,a=t.touches[0],i=$("#VolumeSlider").width(),n=a.pageX-50;n>i&&(n=i);var o=n/i,r=n-10;0>r&&(r=0),$("#VolumeSliderSeek").attr("style","left: "+r+"px"),$("#VolumeSliderh").attr("style","width: "+Math.floor(100*o)+"%");var s=20,l=Math.round(s-s*o),c=0;l>=s/2?(c=l-s/2,c>0&&($("#VolumeContainer").attr("data-command","VolumeDown"),$("#VolumeContainer").attr("data-sendval",c),3>c?($("#hud").hide(),$("#VolumeContainer").attr("data-sendval","0")):$("#hud").text("-"+c+"x").show())):(c=s/2-l,c>0&&($("#VolumeContainer").attr("data-command","VolumeUp"),$("#VolumeContainer").attr("data-sendval",c),3>c?($("#hud").hide(),$("#VolumeContainer").attr("data-sendval","0")):$("#hud").text("+"+c+"x").show()))}),$("#VolumeSliderSeek").bind("touchend",function(){"0"!=$("#VolumeContainer").attr("data-sendval")?sliders.doSlideEvent():sliders.resetVolumeSlider()}),$("#seekbarContainer").bind("touchmove",function(e){if(clearTimeout(slideTimer),"MCE"==util.getCurrentDevice().shortname){e.preventDefault();var t=e.originalEvent,a=t.touches[0],i=$("#slider").width(),n=a.pageX-50;n>i&&(n=i);var o=$("#timespanright").attr("data-duration");if(util.isNumeric(o)){var r=n/i;$("#timeseek").attr("style","left: "+(n-10)+"px"),$("#timebar").attr("style","width: "+Math.floor(100*r)+"%");var s=Math.floor(o*r);$(this).attr("data-sendval",s)}}}),$("#seekbarContainer").bind("touchend",function(){sliders.doSeekEvent()})},doSeekEvent:function(){var e=util.getCurrentDevice();if("MCE"==e.shortname){var t=$("#seekbarContainer").attr("data-sendval"),a=util.getMBUrl()+"ui?command=seek&value="+t+"&controllerName="+$("#timespanright").attr("data-controller");$.getJSON(a,function(){setTimeout(function(){ui.queryNowPlaying()},1500)})}},doSlideEvent:function(){appendOncetoQueryString="&"+$("#VolumeContainer").attr("data-sendval"),gestures.executeGestureByCommandName($("#VolumeContainer").attr("data-command")),sliders.resetVolumeSlider()},resetNPSeek:function(){$("#timeseek").attr("style","left: "+($("#timebar").width()-10)+"px")},resetVolumeSlider:function(){var e=$("#VolumeSlider").width(),t=.5*e;$("#hud").fadeOut(),$("#VolumeSliderSeek").attr("style","left: "+(t-10)+"px"),$("#VolumeSliderh").attr("style","width: "+100*(t/e)+"%")}},ui={initiateBindings:function(){$("#top, #toptrans, #overallVolumeContainer").bind("touchmove",function(e){e.preventDefault()}),ui.bindButtons(),sliders.bindSliders(),bottomDraw.bind()},bindButtons:function(){$("#btnTitles").fastClick(function(){window.scrollTo(0,0),$("#NowPlayingTitle").attr("data-item"),util.getCurrentRoom();var e=util.getCurrentDevice();if("DTV"==e.shortname){var t=[];$.each(guide.channels,function(e,a){var i="";a.ending>0&&(i=new Date(1e3*a.ending).timeNow()),t.push({textLabel:""===a.nowplaying?a.fullname:a.nowplaying,detailTextLabel:a.number+" "+a.fullname+(""===i?"":", ends at "+i),icon:"none",sectionHeader:a.category,major:a.number})});var a=window.plugins.NativeTable;a.createTable({height:$(window).height(),showSearchBar:!0,showNavBar:!0,navTitle:"TV",navBarColor:"black",showRightButton:!0,RightButtonText:"Close",showBackButton:!1}),a.onRightButtonTap(function(){a.hideTable(function(){})}),a.setRowSelectCallBackFunction(function(e){var a=t[e];DirecTV.changeChannel(a.major)}),a.setTableData(t),a.showTable(function(){})}"MCE"==e.shortname&&MediaBrowser.createInitialListView()}),$("#btnConfig").fastClick(function(){navigator.notification.confirm("Delete cached data?",function(e){1==e&&cache.clear()},"Warning","Yes, No")}),$("#btnCommands").fastClick(function(){var e=[],t=util.getCurrentRoom(),a=util.getCurrentDevice(),i="",n=$(xml).find('gesturePad > rooms > room[index="'+t.index+'"] ~ roomgestures > gesture > device');if($(n).size()>0){i="Global Commands";var o=[];$(n).each(function(){var a=$(this);$(this).children("name:first").text(),t.name,$(a).find("command").each(function(){var t=$(this).children("name:first").text(),n="";n=$(a).parent().attr("definition"),"nothing"==n&&(n=""),-1==jQuery.inArray(t,o)&&(o.push(t),e.push({textLabel:t,detailTextLabel:""===n?"No Gesture Defined":"👆 "+n,icon:"greyarrow",sectionHeader:i}))})})}$(xml).find('gesturePad > devices > device[shortname="'+a.shortname+'"]').each(function(){var a=$(this);$(this).children("name:first").text(),t.name,$(a).find("command").each(function(){$(this).find("action");var t="",a=$(this).children("name:first").text();$(this).find("gesture").each(function(e){0===e&&(t="",t=$(this).attr("definition"))}),i!=$(this).parent().children("name:first").text()&&(i=$(this).parent().children("name:first").text()),e.push({textLabel:a,detailTextLabel:""===t?"No Gesture Defined":"👆 "+t,icon:"greyarrow",sectionHeader:i})})});var r=window.plugins.NativeTable;r.createTable({height:$(window).height(),showSearchBar:!0,showNavBar:!0,navTitle:t.name,navBarColor:"black",showRightButton:!0,RightButtonText:"Close",showBackButton:!1}),r.onRightButtonTap(function(){r.hideTable(function(){})}),r.onBackButtonTap(function(){r.hideTable(function(){})}),r.setRowSelectCallBackFunction(function(t){gestures.executeGestureByCommandName(e[t].textLabel)}),r.setTableData(e),r.showTable(function(){})}),$("#btnRoom").fastClick(function(){for(var e=function(e){settings.userSettings.roomIndex=e,settings.userSettings.deviceIndex=0,util.updateStatus(),util.getRoomStatus()},t=window.plugins.actionSheet,a=[],i=settings.userSettings.rooms,n=0;i.length>n;n++)a.push(i[n].name);a.push("Cancel"),t.create({title:"Change Room",items:a,destructiveButtonIndex:a.length-1},function(t,i){-1!=i&&i!=a.length-1&&e(i)})}),$("#btnTransfer").fastClick(function(){for(var e=function(e){var t=util.getCurrentRoom();settings.userSettings.deviceIndex=e;var a=util.getCurrentDevice(),i=a.shortname;if(t.IR){util.setDeviceByShortName("MCE");var n=$(xml).find('gesturePad > devices > device[shortname="MCE"] > commands > category > command > action > onCompleteSetDevice[shortname="'+i+'"]:first');$(n).size()>0&&(gestures.doEvent("manual",$(n).parent()),util.getRoomStatus())}util.updateStatus()},t=window.plugins.actionSheet,a=[],i=util.getCurrentRoom().devices,n=0;i.length>n;n++)a.push(i[n].name);a.push("Cancel"),t.create({title:"Switch Input",items:a,destructiveButtonIndex:a.length-1},function(t,i){-1!=i&&i!=a.length-1&&e(i)})}),$("#btnPower").fastClick(function(){gestures.executeGestureByCommandName("Power")}),$("#btnPlay").fastClick(function(){$(this).hasClass("playing")?(gestures.executeGestureByCommandName("Pause"),$(this).removeClass("playing")):gestures.executeGestureByCommandName("Play")}),$("#btnMute").fastClick(function(){gestures.executeGestureByCommandName("Mute")})},clearNowPlaying:function(){$("#bgPic").attr("class","noart"),$("#bgPic").attr("style",""),$("#bgPic").attr("data-id",""),$("#timespanleft").text("0:00"),$("#timespanright").text("- 0:00"),$("#NowPlayingTitle").text(""),$("#NowPlayingTitle").removeClass("doMarquee"),$("#timeseek").attr("style","left: 0px"),$("#timebar").attr("style","width: 0%")},queryNowPlaying:function(){var e=util.getCurrentDevice();if("MCE"==e.shortname){var t=util.getMBUrl();$.ajax({url:t+"ui",dataType:"json",timeout:1e4,success:function(e){var a=0;try{a=e.Data.PlayingControllers[0].CurrentFileDuration.TotalSeconds}catch(i){return}if(e.Data.PlayingControllers.length>=1){a=e.Data.PlayingControllers[0].CurrentFileDuration.TotalSeconds;var n=e.Data.PlayingControllers[0].CurrentFilePosition.TotalSeconds,o=n/a;$("#timebar").attr("style","width: "+Math.floor(100*o)+"%"),$("#timeseek").attr("style","left: "+($("#timebar").width()-10)+"px"),$("#timespanleft").text(util.hms2(n)),$("#timespanright").text("- "+util.hms2(a-n)),$("#timespanright").attr("data-duration",e.Data.PlayingControllers[0].CurrentFileDuration.Ticks),$("#timespanright").attr("data-controller",e.Data.PlayingControllers[0].ControllerName),$("#NowPlayingTitle").text(e.Data.PlayingControllers[0].PlayableItems[0].DisplayName),parseInt($("#NowPlayingTitle")[0].scrollWidth,10)>parseInt($("#NowPlayingTitle").width(),10)?$("#NowPlayingTitle").attr("class","doMarquee"):$("#NowPlayingTitle").removeClass("doMarquee");var r=e.Data.PlayingControllers[0].PlayableItems[0].CurrentMediaIndex,s=e.Data.PlayingControllers[0].PlayableItems[0].MediaItemIds[r];if($("#bgPic").attr("data-id")!=s){var l="MB_Big_"+s;cache.getImage({id:l,url:t+"image/?Id="+s},function(e){var t=new Image;t.onerror=function(){$("#bgPic").attr("class","noart"),$("#bgPic").attr("style",""),$("#bgPic").attr("data-id",s)},e.cached===!1?(t.onload=function(){cache.saveImage({id:l,img:t}),$("#bgPic").attr("style","background-image: url("+e.url+");"),$("#bgPic").attr("class",""),$("#bgPic").attr("data-id",s)},t.src=e.url):($("#bgPic").attr("style","background-image: url("+e.url+");"),$("#bgPic").attr("class",""),$("#bgPic").attr("data-id",s))})}e.Data.PlayingControllers[0].IsPaused===!0?$("#btnPlay").removeClass("playing"):$("#btnPlay").addClass("playing")}else ui.clearNowPlaying()},error:function(){ui.clearNowPlaying()}})}"DTV"==e.shortname&&$.ajax({type:"GET",url:"http://"+e.IPAddress+":"+e.Port+"/tv/getTuned",dataType:"json",timeout:1e4,success:function(e){if(e.startTime){if("0"==e.startTime)return;var t=e.offset/e.duration;$("#timebar").attr("style","width: "+Math.floor(100*t)+"%"),$("#timeseek").attr("style","left: "+($("#timebar").width()-10)+"px"),$("#timespanleft").text(util.hms2(e.offset)),$("#timespanright").text("- "+util.hms2(e.duration-e.offset))}var a=e.major+" "+e.callsign+" "+e.title;$("#NowPlayingTitle").text(a),$("#NowPlayingTitle").attr("data-item",e.callsign+e.major),$("#NowPlayingTitle").attr("class",""),$.ajax({type:"GET",url:"http://www.thetvdb.com/api/GetSeries.php?seriesname="+e.title,dataType:"xml",error:function(){$("#bgPic").attr("class","noart"),$("#bgPic").attr("style","")},success:function(t){var a="";if($(t).find("Data > Series > SeriesName").each(function(){return $(this).text().toLowerCase().replace(/\W/g,"").replace("the","")==e.title.toLowerCase().replace(/\W/g,"").replace("the","")?(a=$(this).parent().find("seriesid").text(),!1):void 0}),""===a)$("#bgPic").attr("class","noart"),$("#bgPic").attr("style","");else{var i="TVDB_"+a;cache.getImage({id:i,url:""},function(e){e.cached===!1?$.ajax({type:"GET",url:"http://thetvdb.com/api/77658293DB487350/series/"+a+"/",dataType:"xml",error:function(){$("#bgPic").attr("class","noart"),$("#bgPic").attr("style","")},success:function(e){var t=$(e).find("poster:first");if($(t).size()>0){if($("#bgPic").attr("data-id")!=a&&""!==$(t).text()){$("#bgPic").attr("style","background-image: url('http://thetvdb.com/banners/_cache/"+$(t).text()+"');"),$("#bgPic").attr("class",""),$("#bgPic").attr("data-id",a);var n=new Image;n.onload=function(){cache.saveImage({id:i,img:n}),console.log("cached")},n.src="http://thetvdb.com/banners/_cache/"+$(t).text()}}else $("#bgPic").attr("class","noart"),$("#bgPic").attr("style","")}}):($("#bgPic").attr("style","background-image: url("+e.url+");"),$("#bgPic").attr("class",""),$("#bgPic").attr("data-id",a))})}}}),parseInt($("#NowPlayingTitle")[0].scrollWidth,10)>parseInt($("#NowPlayingTitle").width(),10)?$("#NowPlayingTitle").attr("class","doMarquee"):$("#NowPlayingTitle").removeClass("doMarquee")}})}},util={showingHud:!1,doHud:function(e){if(!util.showingHud||!e.show){var t=window.plugins.progressHud;e.show?(util.showingHud=!0,t.show({mode:"indeterminate",labelText:e.labelText,detailsLabelText:e.detailsLabelText},function(){})):(util.showingHud=!1,t.hide())}},compare:function(e,t){return e.catIndex<t.catIndex?-1:e.catIndex>t.catIndex?1:0},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},detectOrientation:function(){window.onorientationchange!==void 0&&util.doResize()},setSwipeThresholds:function(){"tablet"==deviceType&&(HorzLongSwipeThreshold=.5*$("#gestures_canvas").width(),VertLongSwipeThreshold=.5*$("#gestures_canvas").height()),"phone"==deviceType&&(HorzLongSwipeThreshold=.8*$("#gestures_canvas").width(),VertLongSwipeThreshold=.7*$("#gestures_canvas").height())},doResize:function(){$("#card").height($("body").height()-($("#top").outerHeight()+$("#bottom").outerHeight()/3.5));var e=$("#container").height()-($("#top").outerHeight()+$("#bottom").outerHeight()+$("div.toptrans").outerHeight()-1),t=$("body").width();$("#gestures_canvas").attr("height",e),$("#gestures_canvas").attr("width",t),$("#gestures_canvas").height(e),$("#gestures_canvas").width(t),sliders.resetVolumeSlider(),sliders.resetNPSeek(),setTimeout(function(){util.setSwipeThresholds()},1500)},executeObjC:function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null},htmlEscape:function(e){return(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},splash:function(e){try{"hide"==e?navigator.splashscreen.hide():navigator.splashscreen.show()}catch(t){}},setStatusBarMessage:function(e){console.log(e);var t=window.plugins.CDVStatusBarOverlay;t.setStatusBar({message:e,animation:"Shrink",showSpinner:!1}),setTimeout(function(){t.clearStatusBar()},3e3)},getEGBaseUrl:function(){for(var e=util.getCurrentRoom(),t=e.devices,a=0;t.length>a;a++)if("MCE"==t[a].shortname)return"http://"+t[a].IPAddress+":"+t[a].Port+"/";return""},getRandomMBServer:function(){for(var e=[],t=0;settings.userSettings.rooms.length>t;t++){devices=settings.userSettings.rooms[t].devices;for(var a=0;devices.length>a;a++)"MCE"==devices[a].shortname&&e.push("http://"+devices[a].IPAddress+":"+devices[a].ServicePort+"/mbwebapi/service/")}return e[Math.floor(Math.random()*e.length)]},getFirstMBServer:function(){for(var e="",t=0;settings.userSettings.rooms.length>t;t++){devices=settings.userSettings.rooms[t].devices;for(var a=0;devices.length>a;a++)if("MCE"==devices[a].shortname){e="http://"+devices[a].IPAddress+":"+devices[a].ServicePort+"/mbwebapi/service/";break}if(""!==e)break}return e},getMBUrl:function(){for(var e=util.getCurrentRoom(),t=e.devices,a=0;t.length>a;a++)if("MCE"==t[a].shortname)return"http://"+t[a].IPAddress+":"+t[a].ServicePort+"/mbwebapi/service/";return""},getCurrentDevice:function(){return settings.userSettings.rooms?settings.userSettings.rooms.length>0?settings.userSettings.rooms[settings.userSettings.roomIndex].devices.length>0?settings.userSettings.rooms[settings.userSettings.roomIndex].devices[settings.userSettings.deviceIndex]:null:null:void 0},getCurrentRoom:function(){return settings.userSettings.rooms[settings.userSettings.roomIndex]},getDeviceByShortName:function(e){for(var t=util.getCurrentRoom(),a=0;t.devices.length>a;a++)if(t.devices[a].shortname==e)return t.devices[a];return null},setDeviceByShortName:function(e){for(var t=util.getCurrentRoom(),a=0;t.devices.length>a;a++)if(t.devices[a].shortname==e)return settings.userSettings.deviceIndex=a,!0;return!1},getEpochTime:function(){var e=new Date;return Math.round(e.getTime())},epochToDateObject:function(e){return new Date(1e3*e)},getRoomStatus:function(){var e=util.getEGBaseUrl();$.ajax({type:"GET",dataType:"text",url:e,success:function(e){settings.userSettings.deviceIndex=0;try{var t=jQuery.parseJSON(e);if(""!==t.device){var a=util.getDeviceByShortName(t.device);settings.userSettings.deviceIndex=a.index}}catch(i){}util.updateStatus()}})},updateStatus:function(){var e=util.getCurrentDevice(),t=util.getCurrentRoom();$("#txtDevice").text(e.name),$("#txtRoom").text(t.name),t.IR===!0?$("#overallVolumeContainer").show():$("#overallVolumeContainer").hide(),(util.getItem("deviceIndex")!=settings.userSettings.deviceIndex||util.getItem("roomIndex")!=settings.userSettings.roomIndex)&&(util.getItem("deviceIndex")!=settings.userSettings.deviceIndex&&bottomDraw.updateBottomContents(),ui.clearNowPlaying()),setTimeout(function(){ui.queryNowPlaying()},1500),util.setItem("deviceIndex",settings.userSettings.deviceIndex),util.setItem("roomIndex",settings.userSettings.roomIndex)},hms2:function(e){if(0>=e)return"0:00";try{return hours=parseInt(e/3600,10)%24,minutes=parseInt(e/60,10)%60,seconds=e%60,hours+":"+(10>minutes?"0"+minutes:minutes)}catch(t){return"0:00"}},clearCallers:function(e){if(e===!1){var t=$("#gestureCallback div.dofadeout-final");$(t).remove()}else $("#gestureCallback div").remove()},doAlert:function(e){try{navigator.notification.alert(e,null,"gesturePad")}catch(t){alert(e)}},isWifi:function(){if(settings.userSettings.wifi===!1)return!0;try{return"WiFi connection"==util.netState()?!0:!1}catch(e){return!0}},netState:function(){try{var e=navigator.connection.type,t={};return t[Connection.UNKNOWN]="Unknown connection",t[Connection.ETHERNET]="Ethernet connection",t[Connection.WIFI]="WiFi connection",t[Connection.CELL_2G]="Cell 2G connection",t[Connection.CELL_3G]="Cell 3G connection",t[Connection.CELL_4G]="Cell 4G connection",t[Connection.NONE]="No network connection",t[e]}catch(a){return"WiFi connection"}},setItem:function(e,t){localStorage.setItem(e,t)},getItem:function(e,t){try{return localStorage.getItem(e)}catch(a){return 2==arguments.length?t:""}},reloadPage:function(){console.log("reloading"),util.splash("show"),window.location.reload()},playBeep:function(){if(settings.userSettings.sounds)try{navigator.notification.beep()}catch(e){}if(settings.userSettings.vibrate)try{navigator.notification.vibrate(1e3)}catch(e){}},dynamicSort:function(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1,e.length-1)),function(a,i){var n=a[e]<i[e]?-1:a[e]>i[e]?1:0;return n*t}}};$.fn.hasAttr=function(e){return void 0!==this.attr(e)},Date.prototype.timeNow=function(){var e="AM",t=this.getHours();return this.getHours()>12&&(e="PM",t-=12),0===t&&(t=12),e=t+":"+(10>this.getMinutes()?"0":"")+this.getMinutes()+" "+e,"0:00 AM"==e?"":e};